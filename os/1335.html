<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>操作系统概念——特权级 - blog of chuj</title><link rel=icon type=image/png href=https://www.cjovi.icu/favicon.ico><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="关于特权级，一直没有理性认知，只知道高特权级才能访问底特权级这样简单的概念，到现在也不敢说学的很懂，只能简单记录一下。 TSS 及其相关的结构 与用户"><meta property="og:image" content><meta property="og:title" content="操作系统概念——特权级"><meta property="og:description" content="关于特权级，一直没有理性认知，只知道高特权级才能访问底特权级这样简单的概念，到现在也不敢说学的很懂，只能简单记录一下。 TSS 及其相关的结构 与用户"><meta property="og:type" content="article"><meta property="og:url" content="https://www.cjovi.icu/os/1335.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-19T21:49:30+00:00"><meta property="article:modified_time" content="2021-05-19T21:49:30+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="操作系统概念——特权级"><meta name=twitter:description content="关于特权级，一直没有理性认知，只知道高特权级才能访问底特权级这样简单的概念，到现在也不敢说学的很懂，只能简单记录一下。 TSS 及其相关的结构 与用户"><script src=https://www.cjovi.icu/js/feather.min.js></script>
<link href=https://www.cjovi.icu/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://www.cjovi.icu/css/main.44a18422ec0066708fd200e05feb946702a7b17e5d322ff1a35ef8be5c62ad32.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><link rel=stylesheet type=text/css href=https://www.cjovi.icu/css/font.e98a2c89163f90d6fa6d8baf5a50a6561f8ff3d0be1551265f364d138d75df33.css></head><body><div class=content><header><div class=main><a href=https://www.cjovi.icu/>blog of chuj</a></div><nav><a href=/>Home</a>
<a href=/posts.html>All posts</a>
<a href=/about.html>About</a>
<a href=/tags.html>Tags</a></nav></header><main><article><div class=title><h1 class=title>操作系统概念——特权级</h1><div class=meta>Posted on May 19, 2021</div></div><section class=body><p>关于特权级，一直没有理性认知，只知道高特权级才能访问底特权级这样简单的概念，到现在也不敢说学的很懂，只能简单记录一下。</p><h3 id=tss-及其相关的结构>TSS 及其相关的结构</h3><p>与用户进程相关的有一个结构体 <strong>TSS</strong>（<strong>Task State Segment</strong>），存在的一个意义是处理每个任务（进程）的上下文。结构体具体的结构其实不用特别考虑，为了之后解释方便，只需要知道其中存储了寄存器的值和三个栈地址。</p><p>以栈做例子，假设一个操作系统中有用到全部 4 个特权级，那么对于一个最低特权级的进程，需要分配四个栈，即每个特权级各一个栈。不能混用一个栈的原因是各个不同特权级的数据存在一个段中是很难管理的。</p><h3 id=特权级>特权级</h3><p>与特权级有关的有三个名词 <strong>CPL</strong>（<strong>current privilege level</strong>），<strong>DPL</strong>（<strong>request privilege level</strong>），<strong>RPL</strong>（<strong>descriptor privilege level</strong>）。首先说前两个。</p><p>CPL 是对处理器而言的，也就是处理器当前所处的特权级。这个值实际上就是处理器所使用的 CS 段选择子中的 RPL。DPL 则是对数据段的属性（这里把代码段和数据段暂时混为一谈），存储于段描述符（GDT、LDT）的 DPL 字段中。</p><p>当处理器对某个段进行访问时，需要保证 CPL 不小于 DPL，也就是数值上 CPL &lt;= DPL，看起来好像问题已经解决了</p><h3 id=io-特权级>IO 特权级</h3><p>其实我们用不上这个，现代的许多操作系统也用不上，但是还是说一下。简单的来说，就是由于 IO 操作（这里指所有与硬件端口的 IO 操作，不是狭义的输入输出）是非常危险的指令，必须由有一定权限的代码来做，判断是否满足这个一定权限就是由 eflags 寄存器做的，eflags 寄存器的 12~13 位是 IOPL 位，代表 IO 特权级，如果 CPL 数值上小于 IOPL，那么就可以对所有的端口做操作。一般 IOPL 都是 0，即这种超级权限都保留给内核。</p><p>但是如果所有对端口的操作都需要交给内核就会造成大量的</p><p>这是真他妈难写。</p><blockquote><p>本文参考自 《操作系统真像还原》，其实是读书笔记。</p></blockquote></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/os>OS</a></li></ul></nav></div><script src=https://giscus.app/client.js data-repo=chujDK/chujdk.github.io data-repo-id=R_kgDOI__mNg data-category=Announcements data-category-id=DIC_kwDOI__mNs4CYoyP data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><footer><div style=display:flex><a class=soc href=https://github.com/chujDK rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://twitter.com/chujdk rel=me title=Twitter><i data-feather=twitter></i></a>
<a class=border></a></div><div class=footer-info>2023 © chuj | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>