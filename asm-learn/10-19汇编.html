<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>10.19汇编 - blog of chuj</title><link rel=icon type=image/png href=https://www.cjovi.icu/favicon.ico><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I Don't Want to Miss a Thing (From Armageddon Soundtrack) 今天的进度还是比较令人满意的 实验7 今天主要的时间都花在这上面了，就这么几个寄存器卡来卡去，幸运的是最后还是达成了目的。 代"><meta property="og:image" content><meta property="og:title" content="10.19汇编"><meta property="og:description" content="I Don't Want to Miss a Thing (From Armageddon Soundtrack) 今天的进度还是比较令人满意的 实验7 今天主要的时间都花在这上面了，就这么几个寄存器卡来卡去，幸运的是最后还是达成了目的。 代"><meta property="og:type" content="article"><meta property="og:url" content="https://www.cjovi.icu/asm-learn/10-19%E6%B1%87%E7%BC%96.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-10-19T20:55:00+00:00"><meta property="article:modified_time" content="2020-10-19T20:55:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="10.19汇编"><meta name=twitter:description content="I Don't Want to Miss a Thing (From Armageddon Soundtrack) 今天的进度还是比较令人满意的 实验7 今天主要的时间都花在这上面了，就这么几个寄存器卡来卡去，幸运的是最后还是达成了目的。 代"><script src=https://www.cjovi.icu/js/feather.min.js></script>
<link href=https://www.cjovi.icu/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://www.cjovi.icu/css/main.44a18422ec0066708fd200e05feb946702a7b17e5d322ff1a35ef8be5c62ad32.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><link rel=stylesheet type=text/css href=https://www.cjovi.icu/css/font.e98a2c89163f90d6fa6d8baf5a50a6561f8ff3d0be1551265f364d138d75df33.css></head><body><div class=content><header><div class=main><a href=https://www.cjovi.icu/>blog of chuj</a></div><nav><a href=/>Home</a>
<a href=/posts.html>All posts</a>
<a href=/about.html>About</a>
<a href=/tags.html>Tags</a></nav></header><main><article><div class=title><h1 class=title>10.19汇编</h1><div class=meta>Posted on Oct 19, 2020</div></div><section class=body><figure class=wp-block-audio><audio controls src=https://www.cjovi.icu/usr/uploads/2020/10/01-I-Dont-Want-to-Miss-a-Thing-From-_Armageddon_-Soundtrack.m4a></audio><figcaption><span class="has-inline-color has-luminous-vivid-amber-color"><em><a href="https://music.163.com/#/song?id=20506296&market=baiduqk">I Don't Want to Miss a Thing (From Armageddon Soundtrack)</a></em></span></figcaption></figure><p>今天的进度还是比较令人满意的</p><h3>实验7</h3><p>今天主要的时间都花在这上面了，就这么几个寄存器卡来卡去，幸运的是最后还是达成了目的。</p><p>代码之类的在另一篇博客中<strong><a href=https://www.cjovi.icu/asm-learn/%E7%8E%8B%E7%88%BD-%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80-%E7%AC%AC%E5%9B%9B%E7%89%88-%E5%AE%9E%E9%AA%8C7.html><span class="has-inline-color has-luminous-vivid-orange-color">王爽《汇编语言》(第四版) 实验7</span></a></strong>。</p><h4><span class="has-inline-color has-luminous-vivid-amber-color">BP</span></h4><p>没什么新意，一个以ss为默认段寄存器的寻址寄存器。</p><p>第七章主要是<strong>转移指令的原理</strong>和几种转移指令</p><hr class=wp-block-separator><h3>转移指令</h3><h5><span class="has-inline-color has-light-green-cyan-color">offset</span></h5><p>获取标号地址</p><pre class=wp-block-code><code>...
start:
    ....
    mov ax,offset start
...</code></pre><p>以上代码执行后，ax的值就是start标号的地址。配合jmp即可实现跳至任意标号。</p><hr class=wp-block-separator><h5><span class="has-inline-color has-pale-pink-color">jmp</span></h5><p>jmp指令的细节莫名的多，分为短地址转移<code>jmp short s</code>，近地址转移<code>jmp near ptr s</code>，远地址转移<code>jmp far s</code>，寄存器转移（我编的名字）<code>jmp reg</code> (reg是16位寄存器)。段内转移<code>jmp word ptr</code>，段间转移<code>jmp dword ptr</code>。</p><p><code>jmp short s</code> 和 <code>jmp near ptr s</code> 比较类似，都是段内的转移，转移到标号s，不同的是短地址转移的位移范围是-128~127（由此可见这是8位的），而段间近转移范围则是-65536~65535（16位）。</p><p><code>jmp far s</code>则可实现段间远转移CS被赋为标号s所在段段地址，IP被赋为标号s所在的偏移地址</p><p>以上三种转移，转移是IP和CS的改变都被编译器提前计算完成并以机器码形式储存。因此我认为三种转移本质相同，不过是储存改变的变量位数不同，所能达到的转移上限不同罢了。同时，jmp是地址的相对操作，即通过对ip的加减完成，这种方式使得程序被分配到任何内存时都可以正常运行</p><p>寄存器转移，没什么可说的，跳至寄存器所存的地址</p><p><code>jmp word ptr</code>和<code>jmp dword ptr</code>，前者在段内转移，转移至ptr所指内存位置中的值，后者段间转移，此双字的高位字中的值被赋给CS，地位字赋给IP，完成转移。</p><hr class=wp-block-separator><h3>jcxz</h3><p>这个名字真的是很奇怪了，全称为<span class="has-inline-color has-pale-cyan-blue-color">Jmp if CX equal to Zero</span>。</p><p>有其全称，其作用也不难理解</p><pre class=wp-block-code><code>jcxz s
...
s:
...</code></pre><p>以上代码和C</p><pre class=wp-block-code><code>if(cx==0) then goto s;
...
s:
...</code></pre><p>等价（C的goto语法可能有问题，因为我没怎么用过，大概意思在就行了）</p><p>loop指令等价于</p><pre class=wp-block-code><code>s:
...
cx--;
if(cx!=0) jmp short s</code></pre><p>没什么意思</p><hr class=wp-block-separator><h3>实验8 一个奇怪的程序</h3><p>这个实验很有意思</p><pre class=wp-block-code><code>assume cs:codesg
codesg segment
    mov ax,4c00h
    int 21h

    start:
    mov ax,0
    s:
        nop
        nop

        mov di,offset s
        mov si,offset s2
        mov ax,cs:[si]
        mov cs:[di],ax

    s0:
        jmp short s

    s1:
        mov ax,0
        int 21h
        mov ax,0
  
    s2:
        jmp short s1
        nop
codesg ends

end start</code></pre><p>当jmp被复制到nop时，仍然是以相对指令工作（ip-=8），所以正好可以正常返回。如果在s2前面加一条语句程序就会出错，jmp是段内转移，此时ip会被减到负数，然后就会访问到不知何处，所以这样写是危险的，没什么意义，但是作为实验加深理解还是不错的。</p><h3>实验九</h3><p>太棒了，我终于可以输出字符了。</p><pre class=wp-block-code><code>assume cs:code,ds:data

data segment
    db 'welcome to masm!'
    db 00000010b,10100100b,00000001b
data ends

code segment
    start:
    mov ax,data
    mov ds,ax

    mov ax,0b800h
    mov es,ax
    mov bx,0
    mov cx,2000
    sclear:
        mov word ptr es:[bx],0
        add bx,2
    loop sclear

    mov ax,0b878h
    mov es,ax
    s:
    mov bx,0
    mov cx,16
    mov di,0
    s0:
        mov al,[bx]
        mov es:64[di],al
        mov es:224[di],al
        mov es:384[di],al
    
        mov al,ds:[10h]
        mov es:65[di],al
    
        mov al,ds:[11h]
        mov es:225[di],al

        mov al,ds:[12h]
        mov es:385[di],al

        inc bx
        add di,2
    loop s0
    jmp short s
    mov ax,4c00h
    int 21h
code ends

end start</code></pre><p>这个实验介绍了8086显存的存储原理，整理如下</p><p>每一行可显示80个字符，屏幕总共有25行，因此整个屏幕可以显示2000个字符，每个字符用两个字节来表示，低位字节代表字符的ASCII码值，高位字节代表字符的属性值</p><p>属性字节格式：</p><pre class=wp-block-preformatted>       7   6   5   4   3   2   1   0
含义  BL   R   G   B   I   R   G   B
     闪烁    背景色   高亮   前景色</pre><p><span class="has-inline-color has-vivid-cyan-blue-color">蓝底底不闪烁蓝字</span>:10010001b</p><p>显存区域为B8000H~BFFFFH共32KB，总共有八个缓冲页面，每页4KB。</p><p>B8000:0000~B8000:009F对应第零缓冲页的第一行。</p><p>这样就可以操作显示屏了</p></section><div class=post-tags></div><script src=https://giscus.app/client.js data-repo=chujDK/chujdk.github.io data-repo-id=R_kgDOI__mNg data-category=Announcements data-category-id=DIC_kwDOI__mNs4CYoyP data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><footer><div style=display:flex><a class=soc href=https://github.com/chujDK rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://twitter.com/chujdk rel=me title=Twitter><i data-feather=twitter></i></a>
<a class=border></a></div><div class=footer-info>2023 © chuj | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>